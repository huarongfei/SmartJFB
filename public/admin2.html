<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ¤ç½šè®°å½•ç³»ç»Ÿ - SmartJFB</title>
    <link rel="stylesheet" href="css/admin.css">
    <style>
        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section h2 {
            margin-top: 0;
            color: #00d9ff;
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
            padding-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #00ff88;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .foul-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .foul-team-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
        }
        
        .foul-team-header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .foul-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .foul-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .foul-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-foul-add {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .btn-foul-remove {
            background: linear-gradient(45deg, #339af0, #228be6);
            color: white;
        }
        
        .timeout-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .timeout-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .timeout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-timeout-home {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
        }
        
        .btn-timeout-away {
            background: linear-gradient(45deg, #ffd43b, #fcc419);
            color: #000;
        }
        
        .btn-timeout-reset {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .player-selector {
            margin-top: 20px;
        }
        
        .player-selector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .player-select-btn {
            padding: 10px 5px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 11px;
            text-align: center;
        }
        
        .player-select-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .player-select-btn.selected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âš ï¸ SmartJFB åˆ¤ç½šè®°å½•ç³»ç»Ÿ</h1>
            <div class="header-controls">
                <div id="connectionStatus" class="connection-status disconnected">
                    <span class="status-dot"></span>
                    <span class="status-text">æœªè¿æ¥</span>
                </div>
                <button class="btn btn-small" onclick="location.href='admin.html'">æ€»æ§åˆ¶å°</button>
                <button class="btn btn-small" onclick="location.href='admin1.html'">è®¡åˆ†ç³»ç»Ÿ</button>
                <button class="btn btn-small" onclick="location.href='layout-editor.html'">å¸ƒå±€ç¼–è¾‘</button>
                <button class="btn btn-small" onclick="location.href='admin4.html'">çƒå‘˜é˜Ÿå¾½</button>
                <button class="btn btn-small" onclick="location.href='ball-possession.html'">çƒæƒç®¡ç†</button>
                <button class="btn btn-small" onclick="location.href='/'">è¿”å›ä¸»é¡µ</button>
            </div>
        </header>

        <main>
            <!-- å®æ—¶ç»Ÿè®¡æ•°æ® -->
            <section class="section">
                <h2>ğŸ“ˆ å®æ—¶ç»Ÿè®¡æ•°æ®</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ä¸»é˜Ÿå¾—åˆ†</div>
                        <div id="homeScoreStat" class="stat-value">0</div>
                        <div class="stat-label">å½“å‰å¾—åˆ†</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å®¢é˜Ÿå¾—åˆ†</div>
                        <div id="awayScoreStat" class="stat-value">0</div>
                        <div class="stat-label">å½“å‰å¾—åˆ†</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ä¸»é˜ŸçŠ¯è§„</div>
                        <div id="homeFoulsStat" class="stat-value">0</div>
                        <div class="stat-label">æ€»çŠ¯è§„æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å®¢é˜ŸçŠ¯è§„</div>
                        <div id="awayFoulsStat" class="stat-value">0</div>
                        <div class="stat-label">æ€»çŠ¯è§„æ•°</div>
                    </div>
                </div>
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-label">ä¸»é˜Ÿæš‚åœ</div>
                        <div id="homeTimeoutsStat" class="stat-value">5</div>
                        <div class="stat-label">å‰©ä½™æš‚åœ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å®¢é˜Ÿæš‚åœ</div>
                        <div id="awayTimeoutsStat" class="stat-value">5</div>
                        <div class="stat-label">å‰©ä½™æš‚åœ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ¯”èµ›èŠ‚æ¬¡</div>
                        <div id="quarterStat" class="stat-value">1</div>
                        <div class="stat-label">å½“å‰èŠ‚</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ¯”èµ›æ—¶é—´</div>
                        <div id="timeStat" class="stat-value">12:00</div>
                        <div class="stat-label">å‰©ä½™æ—¶é—´</div>
                    </div>
                </div>
            </section>

            <!-- çŠ¯è§„æ§åˆ¶ -->
            <section class="section">
                <h2>âš ï¸ çŠ¯è§„è®°å½•</h2>
                <div class="foul-controls">
                    <div class="foul-team-section">
                        <div class="foul-team-header">
                            <h3>ğŸ  ä¸»é˜ŸçŠ¯è§„ç®¡ç†</h3>
                            <div id="homeSelectedPlayer" style="font-size: 12px; color: #00ff88; margin-top: 5px;">æœªé€‰æ‹©çƒå‘˜</div>
                        </div>
                        <div class="player-selector">
                            <p style="color: rgba(255, 255, 255, 0.7); font-size: 12px; margin-bottom: 10px;">é€‰æ‹©çƒå‘˜:</p>
                            <div class="player-selector-grid" id="homePlayerSelector">
                                <!-- çƒå‘˜æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <div class="foul-buttons">
                            <button class="foul-btn btn-foul-add" onclick="addFoul('home', 'æ™®é€šçŠ¯è§„')">
                                â• æ™®é€šçŠ¯è§„
                            </button>
                            <button class="foul-btn btn-foul-add" onclick="addFoul('home', 'æŠ€æœ¯çŠ¯è§„')">
                                ğŸŸ¨ æŠ€æœ¯çŠ¯è§„
                            </button>
                            <button class="foul-btn btn-foul-add" onclick="addFoul('home', 'è¿ä½“çŠ¯è§„')">
                                ğŸŸ§ è¿ä½“çŠ¯è§„
                            </button>
                            <button class="foul-btn btn-foul-add" onclick="addFoul('home', 'å¤ºæƒçŠ¯è§„')">
                                ğŸŸ¥ å¤ºæƒçŠ¯è§„
                            </button>
                            <button class="foul-btn btn-foul-remove" onclick="removeFoul('home')">
                                â– å‡å°‘çŠ¯è§„
                            </button>
                        </div>
                    </div>
                    <div class="foul-team-section">
                        <div class="foul-team-header">
                            <h3>ğŸƒ å®¢é˜ŸçŠ¯è§„ç®¡ç†</h3>
                            <div id="awaySelectedPlayer" style="font-size: 12px; color: #00ff88; margin-top: 5px;">æœªé€‰æ‹©çƒå‘˜</div>
                        </div>
                        <div class="player-selector">
                            <p style="color: rgba(255, 255, 255, 0.7); font-size: 12px; margin-bottom: 10px;">é€‰æ‹©çƒå‘˜:</p>
                            <div class="player-selector-grid" id="awayPlayerSelector">
                                <!-- çƒå‘˜æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <div class="foul-buttons">
                            <button class="foul-btn btn-foul-add" onclick="addFoul('away', 'æ™®é€šçŠ¯è§„')">
                                â• æ™®é€šçŠ¯è§„
                            </button>
                            <button class="foul-btn btn-foul-add" onclick="addFoul('away', 'æŠ€æœ¯çŠ¯è§„')">
                                ğŸŸ¨ æŠ€æœ¯çŠ¯è§„
                            </button>
                            <button class="foul-btn btn-foul-add" onclick="addFoul('away', 'è¿ä½“çŠ¯è§„')">
                                ğŸŸ§ è¿ä½“çŠ¯è§„
                            </button>
                            <button class="foul-btn btn-foul-add" onclick="addFoul('away', 'å¤ºæƒçŠ¯è§„')">
                                ğŸŸ¥ å¤ºæƒçŠ¯è§„
                            </button>
                            <button class="foul-btn btn-foul-remove" onclick="removeFoul('away')">
                                â– å‡å°‘çŠ¯è§„
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- æš‚åœæ§åˆ¶ -->
            <section class="section">
                <h2>â¸ï¸ æš‚åœæ§åˆ¶</h2>
                <div class="timeout-controls">
                    <button class="timeout-btn btn-timeout-home" onclick="addTimeout('home')">
                        ğŸ  ä¸»é˜Ÿæš‚åœ
                    </button>
                    <button class="timeout-btn btn-timeout-away" onclick="addTimeout('away')">
                        ğŸƒ å®¢é˜Ÿæš‚åœ
                    </button>
                    <button class="timeout-btn btn-timeout-reset" onclick="resetTimeouts()">
                        ğŸ”„ é‡ç½®æš‚åœ
                    </button>
                </div>
            </section>

            <!-- äº‹ä»¶è®°å½• -->
            <section class="section">
                <h2>ğŸ“‹ äº‹ä»¶è®°å½•</h2>
                <div id="eventsList" class="events-list">
                    <div class="no-events">æš‚æ— äº‹ä»¶è®°å½•</div>
                </div>
            </section>
        </main>

        <!-- Toastæç¤º -->
        <div id="toast" class="toast"></div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // Socket.IOè¿æ¥
        const socket = io('http://localhost:3001');
        let selectedHomePlayer = null;
        let selectedAwayPlayer = null;

        // è¿æ¥çŠ¶æ€æ›´æ–°
        socket.on('connect', () => {
            updateConnectionStatus(true);
            console.log('Socket.IOå·²è¿æ¥');
            socket.emit('register_client', 'admin');
        });

        socket.on('disconnect', () => {
            updateConnectionStatus(false);
            console.log('Socket.IOå·²æ–­å¼€');
        });

        socket.on('connect_error', (error) => {
            console.error('Socket.IOé”™è¯¯:', error);
            updateConnectionStatus(false);
        });

        socket.on('initial_data', (data) => {
            handleUpdate({ matchInfo: data });
        });

        socket.on('data_update', (data) => {
            handleUpdate(data);
        });

        socket.on('timer_update', (data) => {
            handleUpdate({ timerStatus: data });
        });

        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.classList.remove('disconnected');
                status.classList.add('connected');
                status.querySelector('.status-text').textContent = 'å·²è¿æ¥';
            } else {
                status.classList.remove('connected');
                status.classList.add('disconnected');
                status.querySelector('.status-text').textContent = 'æœªè¿æ¥';
            }
        }

        function handleUpdate(data) {
            if (data.matchInfo) {
                updateStats(data.matchInfo);
                updatePlayerSelectors(data.matchInfo);
            }
            if (data.timerStatus) {
                updateTimerStatus(data.timerStatus);
            }
            if (data.events) {
                updateEventsList(data.events);
            }
        }

        function updateStats(matchInfo) {
            // æ›´æ–°å¾—åˆ†ç»Ÿè®¡
            document.getElementById('homeScoreStat').textContent = matchInfo.homeTeam?.score || 0;
            document.getElementById('awayScoreStat').textContent = matchInfo.awayTeam?.score || 0;
            
            // æ›´æ–°çŠ¯è§„ç»Ÿè®¡
            document.getElementById('homeFoulsStat').textContent = matchInfo.homeTeam?.fouls || 0;
            document.getElementById('awayFoulsStat').textContent = matchInfo.awayTeam?.fouls || 0;
            
            // æ›´æ–°æš‚åœç»Ÿè®¡ï¼ˆå‡è®¾é»˜è®¤æœ‰5æ¬¡æš‚åœï¼‰
            const homeTimeouts = 5 - (matchInfo.homeTeam?.timeouts || 0);
            const awayTimeouts = 5 - (matchInfo.awayTeam?.timeouts || 0);
            document.getElementById('homeTimeoutsStat').textContent = Math.max(0, homeTimeouts);
            document.getElementById('awayTimeoutsStat').textContent = Math.max(0, awayTimeouts);
            
            // æ›´æ–°æ¯”èµ›ä¿¡æ¯
            document.getElementById('quarterStat').textContent = matchInfo.currentQuarter || '1';
        }

        function updatePlayerSelectors(matchInfo) {
            // æ›´æ–°ä¸»é˜Ÿçƒå‘˜é€‰æ‹©å™¨
            const homeSelector = document.getElementById('homePlayerSelector');
            if (matchInfo.homeTeam?.players) {
                homeSelector.innerHTML = matchInfo.homeTeam.players.map((player, index) => `
                    <button class="player-select-btn" data-index="${index}" data-team="home" 
                            onclick="selectPlayer('home', ${index})">
                        #${player.number || '?'} ${player.name || 'æœªçŸ¥'}
                    </button>
                `).join('');
            } else {
                homeSelector.innerHTML = '<div style="color: rgba(255,255,255,0.5); font-size: 12px;">æš‚æ— çƒå‘˜</div>';
            }

            // æ›´æ–°å®¢é˜Ÿçƒå‘˜é€‰æ‹©å™¨
            const awaySelector = document.getElementById('awayPlayerSelector');
            if (matchInfo.awayTeam?.players) {
                awaySelector.innerHTML = matchInfo.awayTeam.players.map((player, index) => `
                    <button class="player-select-btn" data-index="${index}" data-team="away" 
                            onclick="selectPlayer('away', ${index})">
                        #${player.number || '?'} ${player.name || 'æœªçŸ¥'}
                    </button>
                `).join('');
            } else {
                awaySelector.innerHTML = '<div style="color: rgba(255,255,255,0.5); font-size: 12px;">æš‚æ— çƒå‘˜</div>';
            }
        }

        function selectPlayer(team, index) {
            // å–æ¶ˆä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll(`#${team}PlayerSelector .player-select-btn`).forEach(btn => {
                btn.classList.remove('selected');
            });

            // é€‰æ‹©æ–°çš„çƒå‘˜
            const btn = document.querySelector(`#${team}PlayerSelector .player-select-btn[data-index="${index}"]`);
            if (btn) {
                btn.classList.add('selected');
            }

            // æ›´æ–°é€‰ä¸­çƒå‘˜çŠ¶æ€
            const matchInfoResponse = fetch('/api/match').then(res => res.json()).then(data => {
                const player = data.data[team === 'home' ? 'homeTeam' : 'awayTeam'].players[index];
                if (team === 'home') {
                    selectedHomePlayer = { index, ...player };
                    document.getElementById('homeSelectedPlayer').textContent = `é€‰ä¸­: #${player.number || '?'} ${player.name || 'æœªçŸ¥'}`;
                } else {
                    selectedAwayPlayer = { index, ...player };
                    document.getElementById('awaySelectedPlayer').textContent = `é€‰ä¸­: #${player.number || '?'} ${player.name || 'æœªçŸ¥'}`;
                }
            });
        }

        function updateTimerStatus(timerStatus) {
            if (!timerStatus || !timerStatus.gameClock) return;

            // gameClock æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦è®¿é—® currentTime å±æ€§
            const gameTime = timerStatus.gameClock.currentTime || 0;
            const gameMinutes = Math.floor(gameTime / 60);
            const gameSeconds = Math.floor(gameTime % 60);
            const gameTimeStr = `${String(gameMinutes).padStart(2, '0')}:${String(gameSeconds).padStart(2, '0')}`;
            document.getElementById('timeStat').textContent = gameTimeStr;
        }

        function updateEventsList(events) {
            const container = document.getElementById('eventsList');
            if (!events || events.length === 0) {
                container.innerHTML = '<div class="no-events">æš‚æ— äº‹ä»¶è®°å½•</div>';
                return;
            }

            container.innerHTML = events.slice().reverse().map((event, index) => {
                const eventIcon = getEventIcon(event.type);
                const teamName = event.team === 'home' ? 'ä¸»é˜Ÿ' : 'å®¢é˜Ÿ';
                
                let description = getEventDescription(event);
                
                return `
                    <div class="event-item">
                        <div class="event-icon">${eventIcon}</div>
                        <div class="event-details">
                            <div class="event-team">${teamName}</div>
                            <div class="event-desc">${description}</div>
                            <div class="event-time">${event.quarter}èŠ‚ ${formatEventTime(event.gameTime)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getEventIcon(type) {
            const icons = {
                'score': 'ğŸ€',
                'foul': 'âš ï¸',
                'timeout': 'â¸ï¸',
                'quarter': 'ğŸ“‹'
            };
            return icons[type] || 'ğŸ“Œ';
        }

        function getEventDescription(event) {
            switch (event.type) {
                case 'score':
                    const player = event.playerName || `#${event.playerNumber || '?'}`;
                    const points = event.points === 1 ? 'ç½šçƒ' : event.points === 2 ? '2åˆ†' : '3åˆ†';
                    return `${player} æŠ•ä¸­ ${points}`;
                case 'foul':
                    const foulPlayer = event.playerName || `#${event.playerNumber || '?'}`;
                    const foulType = event.foulType || 'æ™®é€šçŠ¯è§„';
                    return `${foulPlayer} ${foulType}`;
                case 'timeout':
                    return 'è¯·æ±‚æš‚åœ';
                case 'quarter':
                    return `è¿›å…¥${event.quarter}èŠ‚`;
                default:
                    return event.description || 'æœªçŸ¥äº‹ä»¶';
            }
        }

        function formatEventTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // çŠ¯è§„æ§åˆ¶å‡½æ•°
        async function addFoul(team, foulType) {
            try {
                let playerId = null;
                let playerNumber = null;
                let playerName = null;

                // æ ¹æ®é€‰ä¸­çš„çƒå‘˜è®¾ç½®æ•°æ®
                if (team === 'home' && selectedHomePlayer) {
                    playerId = selectedHomePlayer.id;
                    playerNumber = selectedHomePlayer.number;
                    playerName = selectedHomePlayer.name;
                } else if (team === 'away' && selectedAwayPlayer) {
                    playerId = selectedAwayPlayer.id;
                    playerNumber = selectedAwayPlayer.number;
                    playerName = selectedAwayPlayer.name;
                }

                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        team,
                        type: 'foul',
                        foulType,
                        playerId,
                        playerNumber,
                        playerName,
                        quarter: document.getElementById('quarterStat').textContent
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage(`${team === 'home' ? 'ä¸»é˜Ÿ' : 'å®¢é˜Ÿ'} ${foulType} å·²è®°å½•`, 'success');
                    // æ¸…é™¤é€‰ä¸­çŠ¶æ€
                    if (team === 'home') {
                        selectedHomePlayer = null;
                        document.getElementById('homeSelectedPlayer').textContent = 'æœªé€‰æ‹©çƒå‘˜';
                        document.querySelectorAll(`#homePlayerSelector .player-select-btn`).forEach(btn => btn.classList.remove('selected'));
                    } else {
                        selectedAwayPlayer = null;
                        document.getElementById('awaySelectedPlayer').textContent = 'æœªé€‰æ‹©çƒå‘˜';
                        document.querySelectorAll(`#awayPlayerSelector .player-select-btn`).forEach(btn => btn.classList.remove('selected'));
                    }
                } else {
                    showMessage(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('è®°å½•çŠ¯è§„å¤±è´¥:', error);
                showMessage('æ“ä½œå¤±è´¥: ' + error.message, 'error');
            }
        }

        async function removeFoul(team) {
            try {
                const response = await fetch(`/api/fouls/${team}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage(`${team === 'home' ? 'ä¸»é˜Ÿ' : 'å®¢é˜Ÿ'}çŠ¯è§„å·²å‡å°‘`, 'success');
                } else {
                    showMessage(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('å‡å°‘çŠ¯è§„å¤±è´¥:', error);
                showMessage('æ“ä½œå¤±è´¥: ' + error.message, 'error');
            }
        }

        // æš‚åœæ§åˆ¶å‡½æ•°
        async function addTimeout(team) {
            try {
                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        team,
                        type: 'timeout',
                        quarter: document.getElementById('quarterStat').textContent
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage(`${team === 'home' ? 'ä¸»é˜Ÿ' : 'å®¢é˜Ÿ'}æš‚åœå·²è®°å½•`, 'success');
                } else {
                    showMessage(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('è®°å½•æš‚åœå¤±è´¥:', error);
                showMessage('æ“ä½œå¤±è´¥: ' + error.message, 'error');
            }
        }

        async function resetTimeouts() {
            try {
                const response = await fetch('/api/timeouts/reset', {
                    method: 'POST'
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage('æš‚åœæ¬¡æ•°å·²é‡ç½®', 'success');
                } else {
                    showMessage(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('é‡ç½®æš‚åœå¤±è´¥:', error);
                showMessage('æ“ä½œå¤±è´¥: ' + error.message, 'error');
            }
        }

        function showMessage(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>