<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸ƒå±€ç¼–è¾‘å™¨ - SmartJFB</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/layout-editor.css">
    <style>
        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section h2 {
            margin-top: 0;
            color: #00d9ff;
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
            padding-bottom: 10px;
        }
        
        .layout-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .control-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .control-btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-layout-save {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
        }
        
        .btn-layout-load {
            background: linear-gradient(45deg, #339af0, #228be6);
            color: white;
        }
        
        .btn-layout-reset {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .btn-layout-preview {
            background: linear-gradient(45deg, #ffd43b, #fcc419);
            color: #000;
        }
        
        .component-selector {
            margin-top: 20px;
        }
        
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .component-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .component-item:hover {
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .component-item.selected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.2);
        }
        
        .layout-preview {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            min-height: 300px;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-auto-rows: minmax(100px, auto);
            gap: 10px;
        }
        
        .preview-item {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            position: relative;
        }
        
        .preview-item .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }
        
        .preview-item:hover .delete-btn {
            display: block;
        }
        
        .grid-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .grid-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .grid-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }
        
        .btn-grid-add {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
        }
        
        .btn-grid-remove {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .btn-grid-move {
            background: linear-gradient(45deg, #339af0, #228be6);
            color: white;
        }
        
        .layout-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-auto-rows: minmax(60px, auto);
            gap: 5px;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
        }
        
        .grid-cell {
            min-height: 60px;
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .grid-cell:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .grid-cell.drag-over {
            background: rgba(0, 255, 136, 0.2);
            border: 2px solid #00ff88;
        }
        
        .draggable-component {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 10px;
            margin: 5px;
            cursor: move;
            text-align: center;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ SmartJFB å¸ƒå±€ç¼–è¾‘å™¨</h1>
            <div class="header-controls">
                <div id="connectionStatus" class="connection-status disconnected">
                    <span class="status-dot"></span>
                    <span class="status-text">æœªè¿æ¥</span>
                </div>
                <button class="btn btn-small" onclick="location.href='admin.html'">æ€»æ§åˆ¶å°</button>
                <button class="btn btn-small" onclick="location.href='admin1.html'">è®¡åˆ†ç³»ç»Ÿ</button>
                <button class="btn btn-small" onclick="location.href='admin2.html'">åˆ¤ç½šè®°å½•</button>
                <button class="btn btn-small" onclick="location.href='admin4.html'">çƒå‘˜é˜Ÿå¾½</button>
                <button class="btn btn-small" onclick="location.href='ball-possession.html'">çƒæƒç®¡ç†</button>
                <button class="btn btn-small" onclick="location.href='/'">è¿”å›ä¸»é¡µ</button>
            </div>
        </header>

        <main>
            <!-- å¸ƒå±€æ§åˆ¶ -->
            <section class="section">
                <h2>ğŸ’¾ å¸ƒå±€æ§åˆ¶</h2>
                <div class="layout-controls">
                    <div class="control-card">
                        <h3>ä¿å­˜ä¸åŠ è½½</h3>
                        <button class="control-btn btn-layout-save" onclick="saveLayout()">
                            ğŸ’¾ ä¿å­˜å½“å‰å¸ƒå±€
                        </button>
                        <button class="control-btn btn-layout-load" onclick="loadLayout()">
                            ğŸ“ åŠ è½½å¸ƒå±€
                        </button>
                        <button class="control-btn btn-layout-reset" onclick="resetLayout()">
                            ğŸ”„ é‡ç½®å¸ƒå±€
                        </button>
                    </div>
                    <div class="control-card">
                        <h3>é¢„è§ˆä¸åº”ç”¨</h3>
                        <button class="control-btn btn-layout-preview" onclick="previewLayout()">
                            ğŸ‘ï¸ é¢„è§ˆå¸ƒå±€
                        </button>
                        <button class="control-btn btn-layout-save" onclick="applyLayout()">
                            âœ… åº”ç”¨å¸ƒå±€
                        </button>
                        <button class="control-btn btn-layout-reset" onclick="clearDisplay()">
                            ğŸ§¹ æ¸…ç©ºæ˜¾ç¤º
                        </button>
                    </div>
                </div>
            </section>

            <!-- ç»„ä»¶é€‰æ‹© -->
            <section class="section">
                <h2>ğŸ§© ç»„ä»¶é€‰æ‹©</h2>
                <div class="component-selector">
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 15px;">
                        é€‰æ‹©è¦æ·»åŠ åˆ°å¸ƒå±€çš„ç»„ä»¶
                    </p>
                    <div class="component-grid">
                        <div class="component-item" onclick="selectComponent('scoreboard')">
                            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ†</div>
                            <div>è®¡åˆ†æ¿</div>
                        </div>
                        <div class="component-item" onclick="selectComponent('timer')">
                            <div style="font-size: 24px; margin-bottom: 10px;">â±ï¸</div>
                            <div>è®¡æ—¶å™¨</div>
                        </div>
                        <div class="component-item" onclick="selectComponent('shot-clock')">
                            <div style="font-size: 24px; margin-bottom: 10px;">â°</div>
                            <div>è¿›æ”»æ—¶é’Ÿ</div>
                        </div>
                        <div class="component-item" onclick="selectComponent('team-info')">
                            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ‘¥</div>
                            <div>é˜Ÿä¼ä¿¡æ¯</div>
                        </div>
                        <div class="component-item" onclick="selectComponent('player-list')">
                            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“</div>
                            <div>çƒå‘˜åå•</div>
                        </div>
                        <div class="component-item" onclick="selectComponent('statistics')">
                            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“Š</div>
                            <div>ç»Ÿè®¡ä¿¡æ¯</div>
                        </div>
                        <div class="component-item" onclick="selectComponent('video')">
                            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“¹</div>
                            <div>è§†é¢‘æ’­æ”¾</div>
                        </div>
                        <div class="component-item" onclick="selectComponent('text')">
                            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“</div>
                            <div>æ–‡æœ¬æ˜¾ç¤º</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ç½‘æ ¼å¸ƒå±€æ§åˆ¶ -->
            <section class="section">
                <h2>ğŸ“ ç½‘æ ¼å¸ƒå±€æ§åˆ¶</h2>
                <div class="grid-controls">
                    <button class="grid-btn btn-grid-add" onclick="addComponentToGrid()">
                        â• æ·»åŠ åˆ°ç½‘æ ¼
                    </button>
                    <button class="grid-btn btn-grid-remove" onclick="removeComponentFromGrid()">
                        â– ç§»é™¤é€‰ä¸­ç»„ä»¶
                    </button>
                    <button class="grid-btn btn-grid-move" onclick="moveComponent()">
                        ğŸ”„ ç§»åŠ¨ç»„ä»¶
                    </button>
                    <button class="grid-btn btn-grid-add" onclick="adjustGridSize(1)">
                        â• å¢åŠ ç½‘æ ¼è¡Œ
                    </button>
                    <button class="grid-btn btn-grid-remove" onclick="adjustGridSize(-1)">
                        â– å‡å°‘ç½‘æ ¼è¡Œ
                    </button>
                </div>
            </section>

            <!-- æ‹–æ‹½å¸ƒå±€ç¼–è¾‘å™¨ -->
            <section class="section">
                <h2>ğŸ—ï¸ æ‹–æ‹½å¸ƒå±€ç¼–è¾‘å™¨</h2>
                <div class="layout-grid" id="layoutGrid">
                    <!-- 12x12 ç½‘æ ¼å¸ƒå±€ -->
                    <div class="grid-cell" data-row="1" data-col="1"></div>
                    <div class="grid-cell" data-row="1" data-col="2"></div>
                    <div class="grid-cell" data-row="1" data-col="3"></div>
                    <div class="grid-cell" data-row="1" data-col="4"></div>
                    <div class="grid-cell" data-row="1" data-col="5"></div>
                    <div class="grid-cell" data-row="1" data-col="6"></div>
                    <div class="grid-cell" data-row="1" data-col="7"></div>
                    <div class="grid-cell" data-row="1" data-col="8"></div>
                    <div class="grid-cell" data-row="1" data-col="9"></div>
                    <div class="grid-cell" data-row="1" data-col="10"></div>
                    <div class="grid-cell" data-row="1" data-col="11"></div>
                    <div class="grid-cell" data-row="1" data-col="12"></div>
                    
                    <div class="grid-cell" data-row="2" data-col="1"></div>
                    <div class="grid-cell" data-row="2" data-col="2"></div>
                    <div class="grid-cell" data-row="2" data-col="3"></div>
                    <div class="grid-cell" data-row="2" data-col="4"></div>
                    <div class="grid-cell" data-row="2" data-col="5"></div>
                    <div class="grid-cell" data-row="2" data-col="6"></div>
                    <div class="grid-cell" data-row="2" data-col="7"></div>
                    <div class="grid-cell" data-row="2" data-col="8"></div>
                    <div class="grid-cell" data-row="2" data-col="9"></div>
                    <div class="grid-cell" data-row="2" data-col="10"></div>
                    <div class="grid-cell" data-row="2" data-col="11"></div>
                    <div class="grid-cell" data-row="2" data-col="12"></div>
                    
                    <div class="grid-cell" data-row="3" data-col="1"></div>
                    <div class="grid-cell" data-row="3" data-col="2"></div>
                    <div class="grid-cell" data-row="3" data-col="3"></div>
                    <div class="grid-cell" data-row="3" data-col="4"></div>
                    <div class="grid-cell" data-row="3" data-col="5"></div>
                    <div class="grid-cell" data-row="3" data-col="6"></div>
                    <div class="grid-cell" data-row="3" data-col="7"></div>
                    <div class="grid-cell" data-row="3" data-col="8"></div>
                    <div class="grid-cell" data-row="3" data-col="9"></div>
                    <div class="grid-cell" data-row="3" data-col="10"></div>
                    <div class="grid-cell" data-row="3" data-col="11"></div>
                    <div class="grid-cell" data-row="3" data-col="12"></div>
                    
                    <div class="grid-cell" data-row="4" data-col="1"></div>
                    <div class="grid-cell" data-row="4" data-col="2"></div>
                    <div class="grid-cell" data-row="4" data-col="3"></div>
                    <div class="grid-cell" data-row="4" data-col="4"></div>
                    <div class="grid-cell" data-row="4" data-col="5"></div>
                    <div class="grid-cell" data-row="4" data-col="6"></div>
                    <div class="grid-cell" data-row="4" data-col="7"></div>
                    <div class="grid-cell" data-row="4" data-col="8"></div>
                    <div class="grid-cell" data-row="4" data-col="9"></div>
                    <div class="grid-cell" data-row="4" data-col="10"></div>
                    <div class="grid-cell" data-row="4" data-col="11"></div>
                    <div class="grid-cell" data-row="4" data-col="12"></div>
                    
                    <div class="grid-cell" data-row="5" data-col="1"></div>
                    <div class="grid-cell" data-row="5" data-col="2"></div>
                    <div class="grid-cell" data-row="5" data-col="3"></div>
                    <div class="grid-cell" data-row="5" data-col="4"></div>
                    <div class="grid-cell" data-row="5" data-col="5"></div>
                    <div class="grid-cell" data-row="5" data-col="6"></div>
                    <div class="grid-cell" data-row="5" data-col="7"></div>
                    <div class="grid-cell" data-row="5" data-col="8"></div>
                    <div class="grid-cell" data-row="5" data-col="9"></div>
                    <div class="grid-cell" data-row="5" data-col="10"></div>
                    <div class="grid-cell" data-row="5" data-col="11"></div>
                    <div class="grid-cell" data-row="5" data-col="12"></div>
                </div>
            </section>

            <!-- å¸ƒå±€é¢„è§ˆ -->
            <section class="section">
                <h2>ğŸ‘ï¸ å¸ƒå±€é¢„è§ˆ</h2>
                <div class="layout-preview">
                    <div class="preview-grid" id="layoutPreview">
                        <div class="preview-item" data-id="1">
                            <button class="delete-btn" onclick="removePreviewItem(1)">Ã—</button>
                            <div>ğŸ† è®¡åˆ†æ¿</div>
                            <div style="font-size: 10px; margin-top: 5px;">ä¸»é˜Ÿ vs å®¢é˜Ÿ</div>
                        </div>
                        <div class="preview-item" data-id="2">
                            <button class="delete-btn" onclick="removePreviewItem(2)">Ã—</button>
                            <div>â±ï¸ æ¯”èµ›è®¡æ—¶</div>
                            <div style="font-size: 10px; margin-top: 5px;">12:00</div>
                        </div>
                        <div class="preview-item" data-id="3">
                            <button class="delete-btn" onclick="removePreviewItem(3)">Ã—</button>
                            <div>â° è¿›æ”»æ—¶é’Ÿ</div>
                            <div style="font-size: 10px; margin-top: 5px;">24ç§’</div>
                        </div>
                        <div class="preview-item" data-id="4">
                            <button class="delete-btn" onclick="removePreviewItem(4)">Ã—</button>
                            <div>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</div>
                            <div style="font-size: 10px; margin-top: 5px;">å¾—åˆ†/çŠ¯è§„</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Toastæç¤º -->
        <div id="toast" class="toast"></div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // Socket.IOè¿æ¥
        const socket = io('http://localhost:3001');
        let selectedComponent = null;
        let selectedPreviewItem = null;

        // è¿æ¥çŠ¶æ€æ›´æ–°
        socket.on('connect', () => {
            updateConnectionStatus(true);
            console.log('Socket.IOå·²è¿æ¥');
            socket.emit('register_client', 'admin');
        });

        socket.on('disconnect', () => {
            updateConnectionStatus(false);
            console.log('Socket.IOå·²æ–­å¼€');
        });

        socket.on('connect_error', (error) => {
            console.error('Socket.IOé”™è¯¯:', error);
            updateConnectionStatus(false);
        });

        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.classList.remove('disconnected');
                status.classList.add('connected');
                status.querySelector('.status-text').textContent = 'å·²è¿æ¥';
            } else {
                status.classList.remove('connected');
                status.classList.add('disconnected');
                status.querySelector('.status-text').textContent = 'æœªè¿æ¥';
            }
        }

        // ç»„ä»¶é€‰æ‹©åŠŸèƒ½
        function selectComponent(componentType) {
            // å–æ¶ˆä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.component-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // é€‰æ‹©å½“å‰ç»„ä»¶
            event.currentTarget.classList.add('selected');
            selectedComponent = componentType;
            
            showMessage(`å·²é€‰æ‹©ç»„ä»¶: ${getComponentName(componentType)}`, 'info');
        }

        function getComponentName(componentType) {
            const names = {
                'scoreboard': 'è®¡åˆ†æ¿',
                'timer': 'è®¡æ—¶å™¨',
                'shot-clock': 'è¿›æ”»æ—¶é’Ÿ',
                'team-info': 'é˜Ÿä¼ä¿¡æ¯',
                'player-list': 'çƒå‘˜åå•',
                'statistics': 'ç»Ÿè®¡ä¿¡æ¯',
                'video': 'è§†é¢‘æ’­æ”¾',
                'text': 'æ–‡æœ¬æ˜¾ç¤º'
            };
            return names[componentType] || componentType;
        }

        // å¸ƒå±€æ§åˆ¶åŠŸèƒ½
        async function saveLayout() {
            try {
                // è·å–å½“å‰å¸ƒå±€ä¿¡æ¯
                const layout = getCurrentLayout();
                
                const response = await fetch('/api/layout/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(layout)
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage('å¸ƒå±€å·²ä¿å­˜', 'success');
                } else {
                    showMessage(data.message || 'ä¿å­˜å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('ä¿å­˜å¸ƒå±€å¤±è´¥:', error);
                showMessage('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function loadLayout() {
            try {
                const response = await fetch('/api/layout/load');
                
                if (response.ok) {
                    const data = await response.json();
                    showMessage('å¸ƒå±€å·²åŠ è½½', 'success');
                    updatePreview(data.layout);
                } else {
                    showMessage('åŠ è½½å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('åŠ è½½å¸ƒå±€å¤±è´¥:', error);
                showMessage('åŠ è½½å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function resetLayout() {
            if (!confirm('ç¡®å®šè¦é‡ç½®å¸ƒå±€å—ï¼Ÿæ‰€æœ‰è‡ªå®šä¹‰è®¾ç½®å°†ä¸¢å¤±ã€‚')) return;
            
            try {
                const response = await fetch('/api/layout/reset', {
                    method: 'POST'
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage('å¸ƒå±€å·²é‡ç½®', 'success');
                    resetPreview();
                } else {
                    showMessage(data.message || 'é‡ç½®å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('é‡ç½®å¸ƒå±€å¤±è´¥:', error);
                showMessage('é‡ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function applyLayout() {
            try {
                const layout = getCurrentLayout();
                
                const response = await fetch('/api/layout/apply', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(layout)
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage('å¸ƒå±€å·²åº”ç”¨åˆ°æ˜¾ç¤ºç«¯', 'success');
                    socket.emit('layout_update', layout);
                } else {
                    showMessage(data.message || 'åº”ç”¨å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('åº”ç”¨å¸ƒå±€å¤±è´¥:', error);
                showMessage('åº”ç”¨å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é¢„è§ˆåŠŸèƒ½
        function previewLayout() {
            showMessage('å¸ƒå±€é¢„è§ˆå·²æ›´æ–°', 'success');
        }

        function getCurrentLayout() {
            // è·å–å½“å‰é¢„è§ˆå¸ƒå±€çš„æ•°æ®
            const items = document.querySelectorAll('#layoutPreview .preview-item');
            const layout = [];
            
            items.forEach((item, index) => {
                layout.push({
                    id: item.dataset.id,
                    type: item.querySelector('div').textContent.includes('è®¡åˆ†æ¿') ? 'scoreboard' :
                         item.querySelector('div').textContent.includes('æ¯”èµ›è®¡æ—¶') ? 'timer' :
                         item.querySelector('div').textContent.includes('è¿›æ”»æ—¶é’Ÿ') ? 'shot-clock' :
                         item.querySelector('div').textContent.includes('ç»Ÿè®¡ä¿¡æ¯') ? 'statistics' : 'unknown',
                    position: index
                });
            });
            
            return {
                components: layout,
                timestamp: new Date().toISOString()
            };
        }

        function updatePreview(layout) {
            // æ›´æ–°é¢„è§ˆåŒºåŸŸ
            const preview = document.getElementById('layoutPreview');
            preview.innerHTML = '';
            
            layout.components.forEach(component => {
                const item = document.createElement('div');
                item.className = 'preview-item';
                item.dataset.id = component.id;
                
                let content = '';
                switch(component.type) {
                    case 'scoreboard':
                        content = '<button class="delete-btn" onclick="removePreviewItem(' + component.id + ')">Ã—</button><div>ğŸ† è®¡åˆ†æ¿</div><div style="font-size: 10px; margin-top: 5px;">ä¸»é˜Ÿ vs å®¢é˜Ÿ</div>';
                        break;
                    case 'timer':
                        content = '<button class="delete-btn" onclick="removePreviewItem(' + component.id + ')">Ã—</button><div>â±ï¸ æ¯”èµ›è®¡æ—¶</div><div style="font-size: 10px; margin-top: 5px;">12:00</div>';
                        break;
                    case 'shot-clock':
                        content = '<button class="delete-btn" onclick="removePreviewItem(' + component.id + ')">Ã—</button><div>â° è¿›æ”»æ—¶é’Ÿ</div><div style="font-size: 10px; margin-top: 5px;">24ç§’</div>';
                        break;
                    case 'statistics':
                        content = '<button class="delete-btn" onclick="removePreviewItem(' + component.id + ')">Ã—</button><div>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</div><div style="font-size: 10px; margin-top: 5px;">å¾—åˆ†/çŠ¯è§„</div>';
                        break;
                    default:
                        content = '<button class="delete-btn" onclick="removePreviewItem(' + component.id + ')">Ã—</button><div>ğŸ§© ç»„ä»¶</div><div style="font-size: 10px; margin-top: 5px;">æœªçŸ¥ç±»å‹</div>';
                }
                
                item.innerHTML = content;
                preview.appendChild(item);
            });
        }

        function resetPreview() {
            const preview = document.getElementById('layoutPreview');
            preview.innerHTML = `
                <div class="preview-item" data-id="1">
                    <button class="delete-btn" onclick="removePreviewItem(1)">Ã—</button>
                    <div>ğŸ† è®¡åˆ†æ¿</div>
                    <div style="font-size: 10px; margin-top: 5px;">ä¸»é˜Ÿ vs å®¢é˜Ÿ</div>
                </div>
                <div class="preview-item" data-id="2">
                    <button class="delete-btn" onclick="removePreviewItem(2)">Ã—</button>
                    <div>â±ï¸ æ¯”èµ›è®¡æ—¶</div>
                    <div style="font-size: 10px; margin-top: 5px;">12:00</div>
                </div>
                <div class="preview-item" data-id="3">
                    <button class="delete-btn" onclick="removePreviewItem(3)">Ã—</button>
                    <div>â° è¿›æ”»æ—¶é’Ÿ</div>
                    <div style="font-size: 10px; margin-top: 5px;">24ç§’</div>
                </div>
                <div class="preview-item" data-id="4">
                    <button class="delete-btn" onclick="removePreviewItem(4)">Ã—</button>
                    <div>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</div>
                    <div style="font-size: 10px; margin-top: 5px;">å¾—åˆ†/çŠ¯è§„</div>
                </div>
            `;
        }

        function removePreviewItem(id) {
            const item = document.querySelector(`#layoutPreview .preview-item[data-id="${id}"]`);
            if (item) {
                item.remove();
                showMessage('ç»„ä»¶å·²ä»å¸ƒå±€ä¸­ç§»é™¤', 'success');
            }
        }

        // ç½‘æ ¼æ“ä½œåŠŸèƒ½
        function addComponentToGrid() {
            if (!selectedComponent) {
                showMessage('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç»„ä»¶', 'error');
                return;
            }
            
            // åˆ›å»ºå¯æ‹–æ‹½ç»„ä»¶
            const draggable = document.createElement('div');
            draggable.className = 'draggable-component';
            draggable.draggable = true;
            draggable.textContent = getComponentName(selectedComponent);
            
            // æ·»åŠ æ‹–æ‹½äº‹ä»¶
            draggable.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', selectedComponent);
                e.dataTransfer.setData('component-type', selectedComponent);
            });
            
            // æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨ç½‘æ ¼å•å…ƒ
            const firstCell = document.querySelector('.grid-cell:not(:has(*))');
            if (firstCell) {
                firstCell.appendChild(draggable);
            } else {
                // å¦‚æœæ²¡æœ‰ç©ºå•å…ƒï¼Œå°±æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªå•å…ƒ
                const firstCell = document.querySelector('.grid-cell');
                firstCell.appendChild(draggable);
            }
            
            showMessage(`${getComponentName(selectedComponent)} å·²æ·»åŠ åˆ°ç½‘æ ¼`, 'success');
        }

        function removeComponentFromGrid() {
            const selected = document.querySelector('.grid-cell .draggable-component.selected');
            if (selected) {
                selected.remove();
                showMessage('ç»„ä»¶å·²ä»ç½‘æ ¼ä¸­ç§»é™¤', 'success');
            } else {
                showMessage('è¯·å…ˆé€‰æ‹©è¦ç§»é™¤çš„ç»„ä»¶', 'error');
            }
        }

        function moveComponent() {
            showMessage('ç§»åŠ¨åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        function adjustGridSize(change) {
            if (change > 0) {
                // å¢åŠ è¡Œ
                const grid = document.getElementById('layoutGrid');
                const currentRows = grid.children.length / 12;
                const newRow = [];
                
                for (let i = 0; i < 12; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.dataset.row = currentRows + 1;
                    cell.dataset.col = i + 1;
                    grid.appendChild(cell);
                }
                
                showMessage('ç½‘æ ¼è¡Œæ•°å·²å¢åŠ ', 'success');
            } else {
                // å‡å°‘è¡Œï¼ˆå¦‚æœæœ‰å¤šä½™çš„è¡Œï¼‰
                const grid = document.getElementById('layoutGrid');
                const rows = Array.from(grid.children).reduce((acc, cell) => {
                    const row = parseInt(cell.dataset.row);
                    if (!acc.includes(row)) acc.push(row);
                    return acc;
                }, []);
                
                if (rows.length > 1) {
                    // ç§»é™¤æœ€åä¸€è¡Œçš„å•å…ƒæ ¼
                    const maxRow = Math.max(...rows);
                    const cellsToRemove = grid.querySelectorAll(`[data-row="${maxRow}"]`);
                    cellsToRemove.forEach(cell => cell.remove());
                    showMessage('ç½‘æ ¼è¡Œæ•°å·²å‡å°‘', 'success');
                } else {
                    showMessage('ç½‘æ ¼è¡Œæ•°å·²è¾¾åˆ°æœ€å°å€¼', 'error');
                }
            }
        }

        function clearDisplay() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ˜¾ç¤ºç«¯å—ï¼Ÿ')) return;
            
            socket.emit('clear_display');
            showMessage('æ˜¾ç¤ºç«¯å·²æ¸…ç©º', 'success');
        }

        // æ‹–æ‹½åŠŸèƒ½
        document.querySelectorAll('.grid-cell').forEach(cell => {
            cell.addEventListener('dragover', (e) => {
                e.preventDefault();
                cell.classList.add('drag-over');
            });
            
            cell.addEventListener('dragleave', (e) => {
                e.preventDefault();
                cell.classList.remove('drag-over');
            });
            
            cell.addEventListener('drop', (e) => {
                e.preventDefault();
                cell.classList.remove('drag-over');
                
                const componentType = e.dataTransfer.getData('component-type');
                if (componentType) {
                    const draggable = document.createElement('div');
                    draggable.className = 'draggable-component';
                    draggable.draggable = true;
                    draggable.textContent = getComponentName(componentType);
                    
                    // æ·»åŠ æ‹–æ‹½äº‹ä»¶
                    draggable.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('component-type', componentType);
                    });
                    
                    cell.appendChild(draggable);
                }
            });
        });

        function showMessage(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>