<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»è®°åˆ†ç‰Œ - SmartJFB</title>
    <link rel="stylesheet" href="/css/scoreboard.css">
</head>
<body>
    <div class="scoreboard">
        <div class="header">
            <h1>ä¸»è®°åˆ†ç‰Œ</h1>
        </div>

        <div class="match-info">
            <div class="match-status">
                <span id="matchStatus">å‡†å¤‡å°±ç»ª</span>
            </div>
            <div class="match-type">
                <span id="matchType">ç¯®çƒ</span>
            </div>
        </div>

        <div class="teams">
            <div class="team home">
                <div class="team-info">
                    <img id="homeTeamLogo" src="/images/default-logo.png" alt="ä¸»é˜Ÿé˜Ÿå¾½" class="team-logo">
                    <div class="team-name">
                        <h2 id="homeTeamName">ä¸»é˜Ÿ</h2>
                        <span id="homeTeamScore">0</span>
                    </div>
                </div>
            </div>

            <div class="score-display">
                <div class="score">
                    <span id="homeScore">0</span>
                    <span class="separator">-</span>
                    <span id="awayScore">0</span>
                </div>
                <div class="time">
                    <span id="gameTime">12:00</span>
                </div>
                <div class="period">
                    <span>ç¬¬</span>
                    <span id="currentPeriod">1</span>
                    <span>èŠ‚</span>
                </div>
            </div>

            <div class="team away">
                <div class="team-info">
                    <img id="awayTeamLogo" src="/images/default-logo.png" alt="å®¢é˜Ÿé˜Ÿå¾½" class="team-logo">
                    <div class="team-name">
                        <h2 id="awayTeamName">å®¢é˜Ÿ</h2>
                        <span id="awayTeamScore">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- çƒæƒæ˜¾ç¤º -->
        <div class="ball-possession" id="ballPossessionDisplay">
            <div class="possession-indicator" id="homeBallPossession">
                <span>ğŸ€</span>
            </div>
            <div class="possession-text" id="ballPossessionText">æœªè®¾ç½®</div>
            <div class="possession-indicator" id="awayBallPossession">
                <span>ğŸ€</span>
            </div>
        </div>

        <div class="shot-clock" id="shotClockContainer">
            <div class="shot-clock-label">è¿›æ”»æ—¶é’Ÿ</div>
            <div class="shot-clock-time" id="shotClock">24</div>
        </div>

        <div class="footer">
            <div class="connection-status" id="connectionStatus">
                <span class="status-dot"></span>
                <span class="status-text">å·²è¿æ¥</span>
            </div>
            <button onclick="window.location.href='/'" class="btn-back">è¿”å›ä¸»é¡µ</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/socket-client.js"></script>
    <script>
        // åˆå§‹åŒ–Socketè¿æ¥
        const socket = initSocket('scoreboard');

        // ç›‘å¬åˆå§‹æ•°æ®
        socket.on('initial_data', (data) => {
            updateMatchInfo(data);
        });

        // ç›‘å¬æ•°æ®æ›´æ–°
        socket.on('data_update', (data) => {
            if (data.matchInfo) {
                updateMatchInfo(data.matchInfo);
            }
            if (data.timerStatus) {
                updateTimer(data.timerStatus);
            }
            if (data.ballPossession !== undefined) {
                updateBallPossession(data.ballPossession);
            }
            if (data.ballPossessionUpdate) {
                updateBallPossession(data.ballPossessionUpdate.to);
            }
            if (data.events) {
                // å¤„ç†äº‹ä»¶æ›´æ–°ï¼ˆå¦‚æœéœ€è¦ï¼‰
            }
        });

        // ç›‘å¬è®¡æ—¶å™¨æ›´æ–°
        socket.on('timer_update', (data) => {
            updateTimer(data);
        });

        // æ›´æ–°æ¯”èµ›ä¿¡æ¯ï¼ˆä¸åŒ…å«è®¡æ—¶å™¨æ•°æ®ï¼‰
        function updateMatchInfo(data) {
            if (!data) return;

            // æ›´æ–°é˜Ÿä¼ä¿¡æ¯
            if (data.homeTeam) {
                document.getElementById('homeTeamName').textContent = data.homeTeam.name || 'ä¸»é˜Ÿ';
                const homeScore = parseInt(data.homeTeam.score) || 0;
                document.getElementById('homeTeamScore').textContent = homeScore;
                document.getElementById('homeScore').textContent = homeScore;
                if (data.homeTeam.logo) {
                    document.getElementById('homeTeamLogo').src = data.homeTeam.logo;
                }
            }

            if (data.awayTeam) {
                document.getElementById('awayTeamName').textContent = data.awayTeam.name || 'å®¢é˜Ÿ';
                const awayScore = parseInt(data.awayTeam.score) || 0;
                document.getElementById('awayTeamScore').textContent = awayScore;
                document.getElementById('awayScore').textContent = awayScore;
                if (data.awayTeam.logo) {
                    document.getElementById('awayTeamLogo').src = data.awayTeam.logo;
                }
            }

            // æ›´æ–°æ¯”èµ›çŠ¶æ€
            if (data.status) {
                const statusMap = {
                    'not_started': 'æœªå¼€å§‹',
                    'live': 'è¿›è¡Œä¸­',
                    'paused': 'æš‚åœ',
                    'finished': 'å·²ç»“æŸ'
                };
                document.getElementById('matchStatus').textContent = statusMap[data.status] || 'æœªçŸ¥';
            }

            // æ›´æ–°æ¯”èµ›ç±»å‹
            if (data.sportType) {
                const typeMap = {
                    'basketball': 'ç¯®çƒ',
                    'football': 'è¶³çƒ'
                };
                document.getElementById('matchType').textContent = typeMap[data.sportType] || 'æœªçŸ¥';
            }

            // æ›´æ–°å½“å‰èŠ‚æ¬¡
            if (data.gameClock?.currentQuarter !== undefined) {
                document.getElementById('currentPeriod').textContent = data.gameClock.currentQuarter;
            }
        }

        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer(data) {
            if (!data) return;

            // æ›´æ–°æ¯”èµ›æ—¶é—´
            if (data.gameClock?.currentTime !== undefined) {
                const gameTime = data.gameClock.currentTime;
                const minutes = Math.floor(gameTime / 60);
                const seconds = Math.floor(gameTime % 60);
                document.getElementById('gameTime').textContent =
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // æ›´æ–°è¿›æ”»æ—¶é’Ÿ
            if (data.shotClock?.currentTime !== undefined) {
                const shotTime = Math.floor(data.shotClock.currentTime);
                document.getElementById('shotClock').textContent = shotTime;
            }
        }

        // æ›´æ–°çƒæƒæ˜¾ç¤º
        function updateBallPossession(possession) {
            const homeIndicator = document.getElementById('homeBallPossession');
            const awayIndicator = document.getElementById('awayBallPossession');
            const text = document.getElementById('ballPossessionText');

            if (possession === 'home') {
                homeIndicator.classList.add('active');
                awayIndicator.classList.remove('active');
                text.textContent = 'ä¸»é˜Ÿçƒæƒ';
            } else if (possession === 'away') {
                awayIndicator.classList.add('active');
                homeIndicator.classList.remove('active');
                text.textContent = 'å®¢é˜Ÿçƒæƒ';
            } else {
                homeIndicator.classList.remove('active');
                awayIndicator.classList.remove('active');
                text.textContent = 'æœªè®¾ç½®';
            }
        }
    </script>
</body>
</html>
