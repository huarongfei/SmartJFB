# SmartJFB 项目结构说明

## 📁 根目录文件说明

### 启动脚本
- **`启动.bat`** - Windows一键启动脚本（推荐）
- **`start.sh`** - Linux/Mac一键启动脚本
- **`停止.bat`** - Windows停止服务脚本
- **`快速访问.bat`** - 快速打开所有页面

### 配置文件
- **`package.json`** - 项目依赖配置
- **`package-lock.json`** - 依赖版本锁定
- **`.gitignore`** - Git忽略文件配置

### 文档
- **`README.md`** - 基础使用说明
- **`README-PRO.md`** - 专业版功能说明
- **`QUICKSTART.md`** - 快速入门指南
- **`TROUBLESHOOTING.md`** - 故障排除指南
- **`EXPORT-GUIDE.md`** - 数据导出使用指南
- **`COMPLETE.md`** - 项目完成总结
- **`项目结构.md`** - 本文件

---

## 📂 目录结构

```
SmartJFB/
├── 📁 server/                      # 后端服务器
│   ├── index.js                   # 主服务器（Express + Socket.IO）
│   ├── data-store.js              # 核心数据存储
│   ├── timer-controller.js         # 计时控制器（毫秒级精度）
│   ├── export-service.js          # 数据导出服务
│   ├── ad-service.js              # 广告管理服务
│   ├── layout-service.js          # 布局编辑服务
│   ├── socket-handler.js          # WebSocket消息处理
│   └── data/                      # 数据存储目录
│       ├── match-state.json       # 比赛状态数据
│       ├── ads.json               # 广告数据
│       └── layouts.json           # 布局数据
│
├── 📁 public/                      # 前端资源
│   ├── index.html                 # 主页（功能导航）
│   ├── scoreboard.html            # 主记分牌
│   ├── admin.html                 # 管理面板（技术台）
│   ├── statistics.html            # 实时统计面板
│   ├── monitor.html               # 技术台监控器
│   ├── stadium-screen.html         # 现场大屏控制
│   ├── auxiliary-screen.html       # 辅助信息屏
│   ├── export.html                # 数据导出页面
│   ├── ad-manager.html            # 广告管理页面
│   ├── layout-editor.html          # 布局编辑器
│   │
│   ├── 📁 css/                     # 样式文件
│   │   ├── main.css               # 主页样式
│   │   ├── scoreboard.css          # 记分牌样式
│   │   ├── admin.css              # 管理面板样式
│   │   ├── statistics.css         # 统计面板样式
│   │   ├── monitor.css            # 监控器样式
│   │   ├── stadium-screen.css     # 大屏样式
│   │   ├── auxiliary-screen.css    # 辅助屏样式
│   │   ├── export.css             # 导出页面样式
│   │   ├── ad-manager.css         # 广告管理样式
│   │   └── layout-editor.css      # 布局编辑样式
│   │
│   └── 📁 js/                      # JavaScript文件
│       ├── socket-client.js       # Socket.IO客户端
│       ├── main.js                # 主页逻辑
│       ├── scoreboard.js          # 记分牌逻辑
│       ├── admin.js               # 管理面板逻辑
│       ├── statistics.js          # 统计面板逻辑
│       ├── monitor.js             # 监控器逻辑
│       ├── stadium-screen.js      # 大屏逻辑
│       ├── auxiliary-screen.js    # 辅助屏逻辑
│       ├── export.js              # 导出逻辑
│       ├── ad-manager.js          # 广告管理逻辑
│       └── layout-editor.js       # 布局编辑逻辑
│
├── 📁 exports/                     # 导出文件目录（自动创建）
│   ├── summary_*.xlsx             # 比赛摘要导出
│   ├── team-stats_*.xlsx          # 球队统计导出
│   ├── player-stats_*.xlsx        # 球员统计导出
│   └── playbyplay_*.xlsx          # 事件序列导出
│
├── 📁 layouts/                     # 布局导出目录（自动创建）
│   └── layout_*.json              # 布局配置导出
│
├── 📁 uploads/                     # 上传文件目录（自动创建）
│   └── ads/                       # 广告素材上传目录
│       ├── images/                # 图片广告
│       └── videos/                # 视频广告
│
├── 📁 node_modules/               # 依赖包（自动生成）
│
└── 📁 dev/                        # 开发工具
    └── test-api.html              # API测试页面
```

---

## 🎯 核心文件说明

### 后端核心文件

#### server/index.js
主服务器文件，整合所有功能模块：
- Express服务器（HTTP/REST API）
- Socket.IO服务器（WebSocket）
- 路由定义
- 静态文件服务

**API端点数量**: 50+

#### server/data-store.js
核心数据存储模块：
- 比赛状态管理
- 队伍信息管理
- 球员信息管理
- 事件记录管理
- 统计数据计算

#### server/timer-controller.js
计时控制器：
- 毫秒级精度计时
- 比赛时钟控制
- 进攻时钟控制
- 定时事件触发

#### server/export-service.js
数据导出服务：
- Excel导出（使用exceljs）
- CSV导出
- PDF导出（使用pdf-lib）
- 5种导出内容类型

#### server/ad-service.js
广告管理服务：
- 广告CRUD操作
- 定时播放控制
- 播放统计追踪
- 优先级调度

#### server/layout-service.js
布局编辑服务：
- 布局CRUD操作
- 布局验证
- 模板管理
- 导出/导入

### 前端核心文件

#### public/index.html
功能导航主页：
- 10个功能模块卡片
- 渐变UI设计
- 响应式布局

#### public/admin.html
技术台管理面板：
- 比赛控制
- 计分操作
- 队伍管理
- 事件记录

#### public/statistics.html
实时统计面板：
- 实时数据展示
- 球队对比
- 球员排行榜

#### public/export.html
数据导出页面：
- 5种导出类型
- 3种导出格式
- 批量导出功能

#### public/ad-manager.html
广告管理页面：
- 广告列表展示
- 添加/编辑广告
- 统计数据查看

#### public/layout-editor.html
布局编辑器：
- 可视化拖拽编辑
- 组件库面板
- 属性编辑面板
- 实时预览

---

## 📊 文件统计

| 类别 | 文件数 | 代码行数（约） |
|------|--------|---------------|
| 后端JS文件 | 6 | ~2000行 |
| 前端HTML | 10 | ~1000行 |
| 前端CSS | 10 | ~3000行 |
| 前端JS | 11 | ~2500行 |
| 配置文件 | 2 | ~100行 |
| 文档文件 | 7 | ~1500行 |
| 启动脚本 | 4 | ~200行 |
| **总计** | **50+** | **~10300行** |

---

## 🔄 数据流

### 实时数据流
```
用户操作 → WebSocket事件 → 服务器处理 → 数据更新 → 广播 → 所有客户端更新
```

### 导出数据流
```
用户请求 → API调用 → 数据收集 → 格式转换 → 文件生成 → 下载
```

### 广告播放流
```
广告配置 → 定时触发 → 广告选择 → 播放 → 统计记录
```

---

## 🗑️ 已删除的旧文件

以下旧版本文件已被清理：

| 文件名 | 原因 |
|--------|------|
| backend-server.js | 已被server/index.js替代 |
| frontend-server.js | 已被server/index.js替代 |
| backend.html | 已被public/admin.html替代 |
| backend-new.html | 旧版本 |
| backend.js | 旧版本 |
| app.js | 旧版本 |
| server.js | 已被server/index.js替代 |
| index.html | 已被public/index.html替代 |
| display.html | 已被集成到新页面 |
| display.js | 已被集成到新文件 |
| styles.css | 已被public/css/替代 |
| config.js | 配置已集成 |
| generate_activation.* | 不需要的功能 |
| start-all.bat | 使用新的启动.bat |
| start-all.sh | 使用新的start.sh |
| test-server.bat | 功能已集成 |
| check-ports.bat | 功能已集成 |
| api-status.html | 已被集成到监控页面 |
| batch_example.json | 不再需要 |
| -p/ | 临时目录 |

---

## 🚀 快速导航

### 新手入门
1. 运行 `启动.bat` 启动系统
2. 打开 `快速访问.bat` 访问功能
3. 查看 `QUICKSTART.md` 了解基础功能

### 深度使用
1. 阅读 `README-PRO.md` 了解所有功能
2. 查看 `EXPORT-GUIDE.md` 学习导出功能
3. 参考 `TROUBLESHOOTING.md` 解决问题

### 开发者
1. 查看 `项目结构.md`（本文件）
2. 查看源码中的注释
3. 使用 `dev/test-api.html` 测试API

---

## 💡 使用技巧

### 推荐工作流
1. 启动服务器：双击 `启动.bat`
2. 打开管理面板：`快速访问.bat` → 选择3
3. 打开记分牌：`快速访问.bat` → 选择2
4. 开始比赛：在管理面板中操作
5. 导出数据：比赛结束后，在导出页面下载

### 多屏幕设置
1. 主记分牌：投放到大屏幕
2. 管理面板：技术台电脑
3. 统计面板：辅助显示器
4. 监控器：技术台监控

### 自定义布局
1. 打开布局编辑器
2. 拖拽组件到画布
3. 调整位置和尺寸
4. 保存并设置为当前布局
